<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROS2 Robot Status Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/roslibjs/1.3.0/roslib.min.js" integrity="sha512-QbLkRH8UuhbvQpZIeUoq0a4k0QwBi0i9tz9e/0cyL5/8mIIqEb1Sj1DEQEiXoHQkQHVXFMx7/zF/zLPlXDEjA==" crossorigin="anonymous"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #9b59b6;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --warning-color: #e74c3c;
            --success-color: #27ae60;
            --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            --gradient-bg: linear-gradient(135deg, var(--dark-color), #1a2530);
        }
        
        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--gradient-bg);
            color: var(--light-color);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin: 0;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(52, 152, 219, 0.2);
        }
        
        .header p {
            font-size: 1.2rem;
            margin-top: 5px;
            opacity: 0.8;
        }
        
        .connection-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-right: 20px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--warning-color);
            box-shadow: 0 0 10px var(--warning-color);
        }
        
        .connected {
            background-color: var(--success-color);
            box-shadow: 0 0 10px var(--success-color);
            animation: pulse 2s infinite;
        }
        
        .connection-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        input[type="text"] {
            padding: 10px 15px;
            border-radius: 30px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: var(--light-color);
            outline: none;
            min-width: 250px;
        }
        
        button {
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        
        .card-header {
            padding: 15px 20px;
            background: linear-gradient(90deg, rgba(52, 152, 219, 0.2), rgba(155, 89, 182, 0.2));
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card-header h2 {
            margin: 0;
            font-size: 1.3rem;
            color: var(--light-color);
        }
        
        .card-icon {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .card-body {
            padding: 20px;
        }
        
        .status {
            font-size: 1.8rem;
            font-weight: 600;
            text-align: center;
            padding: 10px 0;
            transition: all 0.3s;
        }
        
        .happy { color: var(--success-color); }
        .neutral { color: var(--primary-color); }
        .upset { color: #f39c12; }
        .angry { color: var(--warning-color); }
        
        .menu-container {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: all 0.2s;
            position: relative;
        }
        
        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .menu-item-name {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .menu-item-price {
            background: rgba(52, 152, 219, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 500;
        }
        
        .menu-item-type {
            position: absolute;
            top: -8px;
            left: 10px;
            padding: 2px 10px;
            border-radius: 10px;
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: 700;
        }
        
        .food { background: rgba(46, 204, 113, 0.8); }
        .beverage { background: rgba(52, 152, 219, 0.8); }
        
        .alarm-on { 
            background: rgba(231, 76, 60, 0.1);
            border: 2px solid var(--warning-color);
            animation: pulse-alarm 1s infinite;
        }
        
        .hand-detected {
            background: rgba(52, 152, 219, 0.1);
            border: 2px solid var(--primary-color);
            animation: pulse-blue 1s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(46, 204, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }
        
        @keyframes pulse-alarm {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }
        
        @keyframes pulse-blue {
            0% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(52, 152, 219, 0); }
            100% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0); }
        }
        
        .status-log {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .status-log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .status-log-time {
            color: var(--accent-color);
            margin-right: 10px;
        }
        
        .status-log-error {
            color: var(--warning-color);
        }
        
        /* Customer Order Card */
        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            border-left: 3px solid var(--primary-color);
            align-items: center;
        }
        
        .order-name {
            font-weight: 500;
        }
        
        .order-quantity {
            background: rgba(52, 152, 219, 0.3);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .order-total {
            display: flex;
            justify-content: space-between;
            padding: 15px 5px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 10px;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .order-status {
            text-align: center;
            padding: 10px;
            margin-top: 10px;
            border-radius: 8px;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .status-pending {
            background: rgba(241, 196, 15, 0.2);
            color: #f1c40f;
        }
        
        .status-preparing {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }
        
        .status-ready {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }
        
        .status-delivered {
            background: rgba(155, 89, 182, 0.2);
            color: #9b59b6;
        }
        
        /* Hide scrollbar but keep functionality */
        .menu-container::-webkit-scrollbar {
            width: 5px;
        }
        
        .menu-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .menu-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
        
        .menu-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Glowing effects */
        .glow-effect {
            position: absolute;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(52, 152, 219, 0.5) 0%, rgba(52, 152, 219, 0) 70%);
            z-index: -1;
            opacity: 0.7;
        }
        
        .glow-1 {
            top: -50px;
            right: 20%;
            animation: float 10s ease-in-out infinite;
        }
        
        .glow-2 {
            bottom: 20%;
            left: 10%;
            background: radial-gradient(circle, rgba(155, 89, 182, 0.5) 0%, rgba(155, 89, 182, 0) 70%);
            animation: float 15s ease-in-out infinite reverse;
        }
        
        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(20px, -20px) scale(1.1); }
            100% { transform: translate(0, 0) scale(1); }
        }
        
        /* Media Queries */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .connection-panel {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            
            .connection-status, .connection-controls {
                justify-content: center;
            }
        }

        /* Style for the ROSLIB error message */
        .error-message {
            color: var(--warning-color);
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            display: none;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--warning-color);
        }
    </style>
</head>
<body>
    <div class="glow-effect glow-1"></div>
    <div class="glow-effect glow-2"></div>
    
    <div class="container">
        <div class="header">
            <h1>ROS2 Robot Status Dashboard</h1>
            <p>Real-time monitoring and control interface</p>
        </div>

        <!-- Added ROSLIB error message and button -->
        <div id="roslib-error" class="error-message">
            Failed to load ROSLIB library. Please try an alternative source.
            <button onclick="tryAlternativeLibrary()">Try Alternative ROSLIB Source</button>
        </div>
        
        <div class="connection-panel">
            <div class="connection-status">
                <div id="status-indicator" class="status-indicator"></div>
                <span id="connection-status">Disconnected</span>
            </div>
            
            <div class="connection-controls">
                <input type="text" id="ws-address" value="ws://localhost:9090" placeholder="WebSocket Address">
                <button id="connect-btn" onclick="connectToROS()">Connect</button>
                <button onclick="document.getElementById('ws-address').value='ws://127.0.0.1:9090'; connectToROS()">Local</button>
                <button onclick="document.getElementById('ws-address').value='ws://'+window.location.hostname+':9090'; connectToROS()">Host IP</button>
            </div>
        </div>
        
        <div class="dashboard">
            <div class="card" id="delivery-card">
                <div class="card-header">
                    <h2>Delivery Status</h2>
                    <div class="card-icon">📦</div>
                </div>
                <div class="card-body">
                    <div class="status" id="delivery-status">Unknown</div>
                </div>
            </div>
            
            <div class="card" id="mood-card">
                <div class="card-header">
                    <h2>Customer Mood</h2>
                    <div class="card-icon">😊</div>
                </div>
                <div class="card-body">
                    <div class="status" id="customer-mood">Unknown</div>
                </div>
            </div>
            
            <div class="card" id="alarm-card">
                <div class="card-header">
                    <h2>Alarm Status</h2>
                    <div class="card-icon">🚨</div>
                </div>
                <div class="card-body">
                    <div class="status" id="alarm-status">Off</div>
                </div>
            </div>
            
            <div class="card" id="hand-card">
                <div class="card-header">
                    <h2>Hand Detection</h2>
                    <div class="card-icon">👋</div>
                </div>
                <div class="card-body">
                    <div class="status" id="hand-status">No Hand Detected</div>
                </div>
            </div>
            
            <div class="card" id="order-card">
                <div class="card-header">
                    <h2>Current Order</h2>
                    <div class="card-icon">🧾</div>
                </div>
                <div class="card-body">
                    <div id="current-order">
                        <div class="order-status status-pending">No Active Order</div>
                    </div>
                </div>
            </div>
            
            <div class="card" id="menu-card">
                <div class="card-header">
                    <h2>Available Menu</h2>
                    <div class="card-icon">🍽️</div>
                </div>
                <div class="card-body">
                    <div id="food-menu" class="menu-container">
                        <div class="menu-item">Loading menu...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="status-log" id="status-log"></div>
    </div>

    <script>
        let ros;
        let deliveryListener;
        let moodListener;
        let alarmListener;
        let handListener;
        let menuListener;
        let orderListener;
        let connectionAttempts = 0;
        const maxConnectionAttempts = 3;
        let roslibLoaded = false; // Added to track ROSLIB loading status
        
        // Initialize with default status and check ROSLIB loading
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (typeof ROSLIB === 'undefined') {
                    document.getElementById('roslib-error').style.display = 'block';
                    updateStatusLog('ROSLIB library failed to load.', true);
                    document.getElementById('connect-btn').disabled = true;
                } else {
                    roslibLoaded = true;
                    updateStatusLog('ROSLIB library loaded successfully.');
                    // Auto-connect if URL has autoconnect parameter
                    if (window.location.search.includes('autoconnect')) {
                        setTimeout(function() {
                            updateStatusLog('Attempting auto-connection...');
                            connectToROS();
                        }, 1000);
                    }
                }
                loadDemoMenu();
                initializeHelpText();
            }, 1000);
        });

        // Added function to try an alternative ROSLIB source
        function tryAlternativeLibrary() {
            updateStatusLog('Trying alternative ROSLIB source...');
            
            // Create and append a new script element with an alternative CDN
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/roslib@1.3.0/build/roslib.min.js';
            script.onload = function() {
                updateStatusLog('Alternative ROSLIB library loaded successfully!');
                document.getElementById('roslib-error').style.display = 'none';
                document.getElementById('connect-btn').disabled = false;
                roslibLoaded = true;
            };
            script.onerror = function() {
                updateStatusLog('Failed to load alternative ROSLIB library. Please check your internet connection or try manually downloading the library.', true);
            };
            document.head.appendChild(script);
        }
        
        function connectToROS() {
            // Added check for ROSLIB loading
            if (!roslibLoaded) {
                updateStatusLog('Cannot connect: ROSLIB library not loaded.', true);
                return;
            }

            // Disconnect if already connected
            if (ros) {
                ros.close();
            }
            
            // Reset connection attempts and try connection
            connectionAttempts = 0;
            tryConnection();
        }
        
        function tryConnection() {
            // Added check for ROSLIB loading
            if (!roslibLoaded) {
                updateStatusLog('Cannot connect: ROSLIB library not loaded.', true);
                return;
            }

            connectionAttempts++;
            
            // Get WebSocket address from input
            const wsAddress = document.getElementById('ws-address').value;
            updateStatusLog(`Attempt ${connectionAttempts}: Connecting to ${wsAddress}...`);
            
            try {
                // Create ROS connection
                ros = new ROSLIB.Ros({
                    url: wsAddress
                });

                // Connection event handlers
                ros.on('connection', function() {
                    updateStatusLog('Successfully connected to ROS bridge server');
                    document.getElementById('status-indicator').classList.add('connected');
                    document.getElementById('connection-status').textContent = 'Connected';
                    
                    // Subscribe to topics once connected
                    subscribeToTopics();
                });

                ros.on('error', function(error) {
                    updateStatusLog(`Error connecting to ROS bridge: ${error}`, true);
                    document.getElementById('status-indicator').classList.remove('connected');
                    document.getElementById('connection-status').textContent = 'Error';
                    
                    // Retry connection if under max attempts
                    if (connectionAttempts < maxConnectionAttempts) {
                        updateStatusLog(`Retrying connection in 2 seconds... (${connectionAttempts}/${maxConnectionAttempts})`);
                        setTimeout(tryConnection, 2000);
                    } else {
                        updateStatusLog('Max connection attempts reached. Please check your ROS bridge server.', true);
                    }
                });

                ros.on('close', function() {
                    updateStatusLog('Connection to ROS bridge server closed');
                    document.getElementById('status-indicator').classList.remove('connected');
                    document.getElementById('connection-status').textContent = 'Disconnected';
                });
            } catch (e) {
                updateStatusLog(`Exception during connection: ${e.message}`, true);
            }
        }

        function subscribeToTopics() {
            try {
                // Delivery Status Topic
                deliveryListener = new ROSLIB.Topic({
                    ros: ros,
                    name: '/delivery_status',
                    messageType: 'std_msgs/String'
                });

                deliveryListener.subscribe(function(message) {
                    document.getElementById('delivery-status').textContent = message.data;
                    updateStatusLog(`Received delivery status: ${message.data}`);
                });

                // Customer Mood Topic
                moodListener = new ROSLIB.Topic({
                    ros: ros,
                    name: '/emotion_detection/emotion',
                    messageType: 'std_msgs/String'
                });

                moodListener.subscribe(function(message) {
                    const moodElement = document.getElementById('customer-mood');
                    moodElement.textContent = message.data;
                    
                    // Remove all classes and add the appropriate one
                    moodElement.className = 'status';
                    if (message.data.toLowerCase() === 'happy') {
                        moodElement.classList.add('happy');
                    } else if (message.data.toLowerCase() === 'neutral') {
                        moodElement.classList.add('neutral');
                    } else if (message.data.toLowerCase() === 'upset') {
                        moodElement.classList.add('upset');
                    } else if (message.data.toLowerCase() === 'angry') {
                        moodElement.classList.add('angry');
                    }
                    
                    updateStatusLog(`Received customer mood: ${message.data}`);
                });

                // Alarm Button Topic
                alarmListener = new ROSLIB.Topic({
                    ros: ros,
                    name: '/alarm_button',
                    messageType: 'std_msgs/Bool'
                });

                alarmListener.subscribe(function(message) {
                    const alarmCard = document.getElementById('alarm-card');
                    const alarmStatus = document.getElementById('alarm-status');
                    
                    if (message.data) {
                        alarmStatus.textContent = 'ACTIVATED';
                        alarmCard.classList.add('alarm-on');
                    } else {
                        alarmStatus.textContent = 'Off';
                        alarmCard.classList.remove('alarm-on');
                    }
                    
                    updateStatusLog(`Received alarm status: ${message.data}`);
                });

                // Hand Raised Topic
                handListener = new ROSLIB.Topic({
                    ros: ros,
                    name: '/hand_raised',
                    messageType: 'std_msgs/String'
                });

                handListener.subscribe(function(message) {
                    const handCard = document.getElementById('hand-card');
                    const handStatus = document.getElementById('hand-status');
                    
                    if (message.data) {
                        handStatus.textContent = 'HAND DETECTED';
                        handCard.classList.add('hand-detected');
                    } else {
                        handStatus.textContent = 'No Hand Detected';
                        handCard.classList.remove('hand-detected');
                    }
                    
                    updateStatusLog(`Received hand detection status: ${message.data}`);
                });

                // Food Menu Topic
                menuListener = new ROSLIB.Topic({
                    ros: ros,
                    name: '/food_menu',
                    messageType: 'std_msgs/String'
                });

                menuListener.subscribe(function(message) {
                    try {
                        const menuItems = JSON.parse(message.data);
                        updateMenu(menuItems);
                        updateStatusLog('Received updated menu items');
                    } catch (e) {
                        // If the message isn't JSON, just display it directly
                        document.getElementById('food-menu').innerHTML = 
                            `<div class="menu-item">${message.data}</div>`;
                        updateStatusLog('Received food menu as string: ' + message.data);
                    }
                });
                
                // Customer Order Topic
                orderListener = new ROSLIB.Topic({
                    ros: ros,
                    name: '/customer_order',
                    messageType: 'std_msgs/String'
                });

                orderListener.subscribe(function(message) {
                    console.log('Raw message.data:', message.data); // Debug log
                    try {
                        // Clean the message.data to ensure it's just the JSON string
                        let jsonString = message.data.trim();
                        // If the message includes a "data:" prefix (unlikely via ROS bridge but just in case), remove it
                        if (jsonString.startsWith('data:')) {
                            jsonString = jsonString.replace('data:', '').trim();
                        }
                        console.log('Cleaned JSON string:', jsonString); // Debug log
                        const orderData = JSON.parse(jsonString);
                        console.log('Parsed orderData:', orderData); // Debug log
                        updateOrder(orderData);
                        updateStatusLog('Received new customer order');
                    } catch (e) {
                        console.log('JSON parse error:', e); // Debug log
                        document.getElementById('current-order').innerHTML = 
                            `<div class="order-status status-pending">Error parsing order: ${e.message}</div>`;
                        updateStatusLog(`Failed to parse customer order: ${e.message}`, true);
                    }
                });
                
                updateStatusLog('Successfully subscribed to all ROS topics');
            } catch (e) {
                updateStatusLog(`Error subscribing to topics: ${e.message}`, true);
            }
        }

        // Update menu display with items
        function updateMenu(menuItems) {
            const menuElement = document.getElementById('food-menu');
            menuElement.innerHTML = '';
            
            menuItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'menu-item';
                
                // Determine if item is food or beverage
                const itemType = item.type || (
                    ['tea', 'coffee', 'juice', 'water'].includes(item.name.toLowerCase()) ? 'beverage' : 'food'
                );
                
                itemDiv.innerHTML = `
                    <span class="menu-item-type ${itemType}">${itemType}</span>
                    <span class="menu-item-name">${item.name}</span>
                    <span class="menu-item-price">$${item.price}</span>
                `;
                menuElement.appendChild(itemDiv);
            });
        }
        
        // Update order display
        function updateOrder(orderData) {
            const orderElement = document.getElementById('current-order');
            orderElement.innerHTML = '';
            
            // Items in the order
            orderData.items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'order-item';
                itemDiv.innerHTML = `
                    <span class="order-name">${item.name}</span>
                    <span class="order-quantity">x${item.quantity}</span>
                `;
                orderElement.appendChild(itemDiv);
            });
            
            // Order total
            const totalDiv = document.createElement('div');
            totalDiv.className = 'order-total';
            totalDiv.innerHTML = `
                <span>Total:</span>
                <span>$${orderData.total.toFixed(2)}</span>
            `;
            orderElement.appendChild(totalDiv);
            
            // Order status
            const statusDiv = document.createElement('div');
            statusDiv.className = `order-status status-${orderData.status.toLowerCase()}`;
            statusDiv.textContent = orderData.status;
            orderElement.appendChild(statusDiv);
        }

        // Add a status log entry
        function updateStatusLog(message, isError = false) {
            const statusElement = document.createElement('div');
            statusElement.className = 'status-log-entry';
            if (isError) {
                statusElement.classList.add('status-log-error');
            }
            
            statusElement.innerHTML = `
                <span class="status-log-time">[${new Date().toLocaleTimeString()}]</span>
                ${message}
            `;
            
            const statusLog = document.getElementById('status-log');
            statusLog.prepend(statusElement);
            
            // Keep only last 50 entries
            if (statusLog.children.length > 50) {
                statusLog.removeChild(statusLog.lastChild);
            }
            
            console.log(message);
        }
        
        // Load demo menu with foods and beverages
        function loadDemoMenu() {
            const demoMenu = [
                { name: "Pizza", price: "12.99", type: "food" },
                { name: "Burger", price: "8.99", type: "food" },
                { name: "Salad", price: "7.99", type: "food" },
                { name: "Pasta", price: "10.99", type: "food" },
                { name: "Coffee", price: "3.99", type: "beverage" },
                { name: "Tea", price: "2.99", type: "beverage" },
                { name: "Juice", price: "4.99", type: "beverage" },
                { name: "Water", price: "1.99", type: "beverage" }
            ];
            
            updateMenu(demoMenu);
            
            // Demo order
            const demoOrder = {
                items: [
                    { name: "Pizza", quantity: 1, price: 12.99 },
                    { name: "Coffee", quantity: 2, price: 3.99 }
                ],
                total: 20.97,
                status: "Pending"
            };
            
            // Display demo order after a short delay to simulate receiving an order
            setTimeout(() => {
                updateOrder(demoOrder);
                updateStatusLog("Demo order loaded");
            }, 1500);
            
            // Set some demo statuses
            document.getElementById('delivery-status').textContent = "Waiting";
            document.getElementById('customer-mood').textContent = "Neutral";
            document.getElementById('customer-mood').className = "status neutral";
            
            updateStatusLog("Demo data loaded successfully");
        }

        // Function to send a command to the robot
        function sendRobotCommand(command, value) {
            if (!ros || !ros.isConnected) {
                updateStatusLog("Cannot send command: Not connected to ROS", true);
                return;
            }
            
            try {
                const cmdTopic = new ROSLIB.Topic({
                    ros: ros,
                    name: '/robot_command',
                    messageType: 'std_msgs/String'
                });
                
                const message = new ROSLIB.Message({
                    data: JSON.stringify({
                        command: command,
                        value: value
                    })
                });
                
                cmdTopic.publish(message);
                updateStatusLog(`Command sent: ${command} = ${value}`);
            } catch (e) {
                updateStatusLog(`Error sending command: ${e.message}`, true);
            }
        }

        // Periodically check connection status
        setInterval(function() {
            if (ros) {
                if (ros.isConnected) {
                    document.getElementById('status-indicator').classList.add('connected');
                    document.getElementById('connection-status').textContent = 'Connected';
                } else {
                    document.getElementById('status-indicator').classList.remove('connected');
                    document.getElementById('connection-status').textContent = 'Disconnected';
                }
            }
        }, 5000);

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Alt+C to connect
            if (event.altKey && event.key === 'c') {
                connectToROS();
            }
            
            // Alt+D to disconnect
            if (event.altKey && event.key === 'd') {
                if (ros) {
                    ros.close();
                    updateStatusLog('Manually disconnected from ROS');
                }
            }
            
            // Alt+R to refresh demo data
            if (event.altKey && event.key === 'r') {
                loadDemoMenu();
                updateStatusLog('Demo data refreshed');
            }
        });

        // Initialize tooltips and help text
        function initializeHelpText() {
            const connectBtn = document.getElementById('connect-btn');
            connectBtn.title = "Connect to ROS Bridge (Alt+C)";
            
            updateStatusLog('Help text initialized');
        }
    </script>
</body>
</html>